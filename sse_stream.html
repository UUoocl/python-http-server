<!DOCTYPE html>
<html>
<head><title>OBS SSE Test</title></head>
<body>
    <h1>OBS SSE Connection Test</h1>
    <p>Status: <span id="status">Connecting...</span></p>
    <div id="messages"></div>
    <script>
        const eventSource = new EventSource('http://localhost:8080/sse-stream');
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');

        eventSource.onopen = function(event) {
            statusEl.textContent = 'Connected!';
            statusEl.style.color = 'green';
            console.log('SSE connection opened.');
        };

        eventSource.onerror = function(event) {
            statusEl.textContent = 'Error/Disconnected!';
            statusEl.style.color = 'red';
            console.error('SSE Error:', event);
            eventSource.close();
        };

        // Custom event handler for 'welcome'
        eventSource.addEventListener('welcome', function(event) {
            const data = event.data;
            messagesEl.innerHTML += `<p><strong>[WELCOME]</strong> ${data}</p>`;
            console.log('Welcome Message:', data);
        });

        // Custom event handler for 'update' (from the pusher thread)
        eventSource.addEventListener('update', function(event) {
            try {
                const data = JSON.parse(event.data);
                messagesEl.innerHTML += `<p>[${data.time}] Counter: <strong>${data.counter}</strong> - ${data.message}</p>`;
            } catch (e) {
                console.error("Failed to parse JSON for update event:", event.data, e);
            }
        });

        // Custom event handler for 'hotkey_trigger'
        eventSource.addEventListener('hotkey_trigger', function(event) {
            try {
                const data = JSON.parse(event.data);
                // Display the new event information
                messagesEl.innerHTML += `<p style="color: blue;">[${data.time}] Hotkey Pressed! Count: <strong>${data.press_count}</strong> - ${data.message}</p>`;
            } catch (e) {
                console.error("Failed to parse JSON for hotkey_trigger event:", event.data, e);
            }
        });
        
        // The default message event (if event: is not specified)
        eventSource.onmessage = function(event) {
            console.log('Default Message:', event.data);
        };
    </script>
</body>
</html>